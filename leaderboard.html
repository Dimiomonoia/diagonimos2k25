<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ÎšÎ±Ï„Î¬Ï„Î±Î¾Î· â€” ClimateActionNow</title>
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
  <!-- Header / Nav -->
  <header class="nav">
    <div class="container nav-inner">
      <a class="brand" href="index.html">
        <span class="logo-box">
          <!-- globe icon -->
          <svg class="logo-globe" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="12" cy="12" r="9"></circle>
            <path d="M3 12h18"></path>
            <path d="M12 3a14 14 0 0 1 0 18"></path>
            <path d="M12 3a14 14 0 0 0 0 18"></path>
            <path d="M5.5 7.5c2 .8 4.7 1.2 6.5 1.2 1.8 0 4.5-.4 6.5-1.2"></path>
            <path d="M5.5 16.5c2-.8 4.7-1.2 6.5-1.2 1.8 0 4.5.4 6.5 1.2"></path>
          </svg>
        </span>
        <span class="brand-name">ClimateActionNow</span>
      </a>

      <nav style="margin-left:auto">
        <ul>
          <li><a href="index.html" class="navlink">Î‘ÏÏ‡Î¹ÎºÎ®</a></li>
          <li><a href="ways.html" class="navlink">Î™Î´Î­ÎµÏ‚ Î”ÏÎ¬ÏƒÎ·Ï‚</a></li>
          <li><a href="add.html" class="navlink">Î¥Ï€Î¿Î²Î¿Î»Î® Î”ÏÎ¬ÏƒÎ·Ï‚</a></li>
          <li><a href="rewards.html" class="navlink">Î”ÏÏÎ± Î”Î¹Î±Î³Ï‰Î½Î¹ÏƒÎ¼Î¿Ï</a></li>
          <li><a href="games.html" class="navlink">Î Î±Î¹Ï‡Î½Î¯Î´Î¹Î±</a></li>
          <li><a href="leaderboard.html" class="navlink active">ÎšÎ±Ï„Î¬Ï„Î±Î¾Î·</a></li>
          <li><a href="account.html" class="navlink">ÎŸ Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ Î¼Î¿Ï…</a></li>
          <li id="authArea"></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="wrap">
    <div class="board-card">
      <div class="board-head">
        <div>
          <h1>ÎšÎ±Ï„Î¬Ï„Î±Î¾Î· ÎœÎµÎ»ÏÎ½</h1>
          <div class="muted">Top ÎµÎ½ÎµÏÎ³Î¬ Î¼Î­Î»Î· Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¿Ï…Ï‚ Ï€ÏŒÎ½Ï„Î¿Ï…Ï‚ (+3 bonus Î±Î½ ÎµÎ¯Î½Î±Î¹ ÎµÎ¸ÎµÎ»Î¿Î½Ï„Î®Ï‚/Î½Ï„ÏÎ¹Î±).</div>
        </div>
        <div class="toolbar">
          <button id="refreshBoard" class="btn">Î‘Î½Î±Î½Î­Ï‰ÏƒÎ·</button>
        </div>
      </div>

      <div id="boardWrap">
        <!-- ÎŸ Ï€Î¯Î½Î±ÎºÎ±Ï‚ Î¸Î± Î³ÎµÎ¼Î¯ÏƒÎµÎ¹ Î±Ï€ÏŒ Firestore -->
        <div class="empty" style="padding:16px;">Î¦ÏŒÏÏ„Ï‰ÏƒÎ·...</div>
      </div>
    </div>
  </main>

  <!-- ÎšÏÏÎ¹Î¿ Script: Firestore ONLY (ÎºÎ±Î¼Î¯Î± Ï‡ÏÎ®ÏƒÎ· localStorage) -->
  <script type="module">
    // Firebase SDK (ES modules)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy, limit }
      from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    // >>> Î’Î‘Î›Î• Î•Î”Î© Î¤ÎŸ Î”Î™ÎšÎŸ Î£ÎŸÎ¥ CONFIG Î±Ï€ÏŒ Ï„Î¿ Firebase console <<<
    const firebaseConfig = {
      apiKey: "AIzaSyDQ3YspHTSo-MSqn8Cv3U43GvZtb-1SuaY",
      authDomain: "diagonismos2k25.firebaseapp.com",
     projectId: "diagonismos2k25",
     storageBucket: "diagonismos2k25.firebasestorage.app",
     messagingSenderId: "1095449376797",
     appId: "1:1095449376797:web:8eea57548f9438dcee6ef4",
     measurementId: "G-791ZTFWWJM"
   };


    // Init
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    // Î¦ÏŒÏÏ„Ï‰ÏƒÎ· 20 ÎºÎ¿ÏÏ…Ï†Î±Î¯Ï‰Î½
    async function loadLeaderboard() {
      try {
        const q = query(collection(db, "users"), orderBy("points", "desc"), limit(20));
        const snap = await getDocs(q);
        const rows = [];
        snap.forEach(d => rows.push(d.data())); // {display, points, volunteer, isAdmin}

        renderBoard(rows);
      } catch (err) {
        document.querySelector('#boardWrap').innerHTML =
          `<div class="empty">Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚: ${err?.message || err}</div>`;
      }
    }

    // Î‘Ï€ÏŒÎ´Î¿ÏƒÎ· Ï€Î¯Î½Î±ÎºÎ±
    function renderBoard(rows){
      const wrap = document.querySelector('#boardWrap');
      if(!rows.length){
        wrap.innerHTML = '<div class="empty">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î±ÎºÏŒÎ¼Î· ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚.</div>';
        return;
      }

      const medal = (i)=> i===0?'ğŸ¥‡':i===1?'ğŸ¥ˆ':i===2?'ğŸ¥‰':(i+1);

      const html = `
        <table class="table">
          <thead>
            <tr><th class="rank">#</th><th>ÎœÎ­Î»Î¿Ï‚</th><th>Î ÏŒÎ½Ï„Î¿Î¹</th></tr>
          </thead>
          <tbody>
            ${rows.map((r,i)=>`
              <tr>
                <td class="rank">${medal(i)}</td>
                <td class="name-cell">
                  <span class="avatar">${(r.display||'?').slice(0,1).toUpperCase()}</span>
                  <span>${r.display || 'Î§Ï‰ÏÎ¯Ï‚ ÏŒÎ½Î¿Î¼Î±'}${r.isAdmin ? ' <span class="badge-admin">Admin</span>' : ''}</span>
                </td>
                <td><strong>${r.points ?? 0}</strong></td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      wrap.innerHTML = html;
    }

    // ÎšÎ¿Ï…Î¼Ï€Î¯ Î±Î½Î±Î½Î­Ï‰ÏƒÎ·Ï‚
    document.querySelector('#refreshBoard')?.addEventListener('click', loadLeaderboard);

    // Î¦ÏŒÏÏ„Ï‰ÏƒÎ· ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ¯ÏƒÎ¿Î´Î¿
    loadLeaderboard();
  </script>
</body>
</html>
