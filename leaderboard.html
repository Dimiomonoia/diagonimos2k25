<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Κατάταξη — ClimateActionNow</title>
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
  <!-- Header / Nav -->
  <header class="nav">
    <div class="container nav-inner">
      <a class="brand" href="index.html">
        <span class="logo-box">
          <!-- globe icon -->
          <svg class="logo-globe" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="12" cy="12" r="9"></circle>
            <path d="M3 12h18"></path>
            <path d="M12 3a14 14 0 0 1 0 18"></path>
            <path d="M12 3a14 14 0 0 0 0 18"></path>
            <path d="M5.5 7.5c2 .8 4.7 1.2 6.5 1.2 1.8 0 4.5-.4 6.5-1.2"></path>
            <path d="M5.5 16.5c2-.8 4.7-1.2 6.5-1.2 1.8 0 4.5.4 6.5 1.2"></path>
          </svg>
        </span>
        <span class="brand-name">ClimateActionNow</span>
      </a>

      <nav style="margin-left:auto">
        <ul>
          <li><a href="index.html" class="navlink">Αρχική</a></li>
          <li><a href="ways.html" class="navlink">Ιδέες Δράσης</a></li>
          <li><a href="add.html" class="navlink">Υποβολή Δράσης</a></li>
          <li><a href="rewards.html" class="navlink">Δώρα Διαγωνισμού</a></li>
          <li><a href="games.html" class="navlink">Παιχνίδια</a></li>
          <li><a href="leaderboard.html" class="navlink active">Κατάταξη</a></li>
          <li><a href="account.html" class="navlink">Ο Λογαριασμός μου</a></li>
          <li id="authArea"></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="wrap">
    <div class="board-card">
      <div class="board-head">
        <div>
          <h1>Κατάταξη Μελών</h1>
          <div class="muted">Top ενεργά μέλη με βάση τους πόντους (+3 bonus αν είναι εθελοντής/ντρια).</div>
        </div>
        <div class="toolbar">
          <button id="refreshBoard" class="btn">Ανανέωση</button>
        </div>
      </div>

      <div id="boardWrap">
        <!-- Ο πίνακας θα γεμίσει από Firestore -->
        <div class="empty" style="padding:16px;">Φόρτωση...</div>
      </div>
    </div>
  </main>

  <!-- Κύριο Script: Firestore ONLY (καμία χρήση localStorage) -->
  <script type="module">
    // Firebase SDK (ES modules)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy, limit }
      from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    // >>> ΒΑΛΕ ΕΔΩ ΤΟ ΔΙΚΟ ΣΟΥ CONFIG από το Firebase console <<<
    const firebaseConfig = {
      apiKey: "AIzaSyDQ3YspHTSo-MSqn8Cv3U43GvZtb-1SuaY",
      authDomain: "diagonismos2k25.firebaseapp.com",
     projectId: "diagonismos2k25",
     storageBucket: "diagonismos2k25.firebasestorage.app",
     messagingSenderId: "1095449376797",
     appId: "1:1095449376797:web:8eea57548f9438dcee6ef4",
     measurementId: "G-791ZTFWWJM"
   };


    // Init
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    // Φόρτωση 20 κορυφαίων
    async function loadLeaderboard() {
      try {
        const q = query(collection(db, "users"), orderBy("points", "desc"), limit(20));
        const snap = await getDocs(q);
        const rows = [];
        snap.forEach(d => rows.push(d.data())); // {display, points, volunteer, isAdmin}

        renderBoard(rows);
      } catch (err) {
        document.querySelector('#boardWrap').innerHTML =
          `<div class="empty">Σφάλμα φόρτωσης: ${err?.message || err}</div>`;
      }
    }

    // Απόδοση πίνακα
    function renderBoard(rows){
      const wrap = document.querySelector('#boardWrap');
      if(!rows.length){
        wrap.innerHTML = '<div class="empty">Δεν υπάρχουν ακόμη καταχωρήσεις.</div>';
        return;
      }

      const medal = (i)=> i===0?'🥇':i===1?'🥈':i===2?'🥉':(i+1);

      const html = `
        <table class="table">
          <thead>
            <tr><th class="rank">#</th><th>Μέλος</th><th>Πόντοι</th></tr>
          </thead>
          <tbody>
            ${rows.map((r,i)=>`
              <tr>
                <td class="rank">${medal(i)}</td>
                <td class="name-cell">
                  <span class="avatar">${(r.display||'?').slice(0,1).toUpperCase()}</span>
                  <span>${r.display || 'Χωρίς όνομα'}${r.isAdmin ? ' <span class="badge-admin">Admin</span>' : ''}</span>
                </td>
                <td><strong>${r.points ?? 0}</strong></td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      wrap.innerHTML = html;
    }

    // Κουμπί ανανέωσης
    document.querySelector('#refreshBoard')?.addEventListener('click', loadLeaderboard);

    // Φόρτωση κατά την είσοδο
    loadLeaderboard();
  </script>
</body>
</html>
